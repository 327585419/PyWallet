#:kivy 1.10.0

#:import webbrowser webbrowser
#:import MDList kivymd.list.MDList
#:import MDSlider kivymd.slider.MDSlider
#:import MDTextField kivymd.textfields.MDTextField
#:import MDBottomNavigation kivymd.tabs.MDBottomNavigation
#:import QRCodeWidget kivy.garden.qrcode
#:import MDNavigationDrawer kivymd.navigationdrawer.MDNavigationDrawer
#:import NavigationLayout kivymd.navigationdrawer.NavigationLayout
#:import NavigationDrawerToolbar kivymd.navigationdrawer.NavigationDrawerToolbar


<PushUp@BoxLayout>:
    # need this hack to push widgets up
    id: push_up

<Navigation@NavigationLayout>:
    MDNavigationDrawer:
        id: navigation_drawer
        NavigationDrawerToolbar:
            title: "Menu"
        NavigationDrawerIconButton:
            icon: "home"
            text: "Home"
            on_release: app.controller.load_landing_page()
        NavigationDrawerIconButton:
            icon: "key"
            text: "Keystore"
            on_release: app.controller.load_manage_keystores()
        NavigationDrawerIconButton:
            icon: "help"
            text: "About"
            on_release: app.controller.load_about_screen()


<PasswordForm>:
    orientation: 'vertical'
    MDTextField:
        id: password_id
        hint_text: "Password"
        helper_text: "Enter the password to unlock your account"
        helper_text_mode: "on_focus"
        text: root.password
        password: True
        on_text: root.password = args[1]


<PWSelectList>:
    orientation: 'vertical'
    ScrollView:
        do_scroll_x: False
        MDList:
            id: address_list_id


<Send>:
    orientation: 'vertical'
    # TODO: handle from address
    MDTextField:
        hint_text: "To"
        helper_text: "Receiver Ethereum address"
        helper_text_mode: "persistent"
        required: True
        text: root.send_to_address
        on_text: root.send_to_address = args[1]
    FloatInput:
        hint_text: "Amount ETH (e.g. 1.10)"
        required: True
        text: str(root.send_amount)
        on_text: root.send_amount = args[1]
    MDRaisedButton:
        pos_hint: {'center_x': 0.5}
        text: "Send"
        on_release: self.parent.on_send_click()
    PushUp:


<Receive>:
    orientation: 'vertical'
    MDFlatButton:
        pos_hint: {'center_x': 0.5, 'top': 1}
        size_hint: None, None
        text: root.current_account_string
        on_release: root.open_account_list()
    QRCodeWidget:
        id: qr_code_id


<Overview>:
    orientation: 'vertical'
    MDLabel:
        id: balance_label_id
        size_hint_y: None
        height: dp(40)
        font_style: 'Display1'
        halign: 'center'
        text: '0 ETH'
    MDFlatButton:
        pos_hint: {'center_x': 0.5, 'top': 1}
        size_hint: None, None
        text: root.current_account_string
        on_release: root.open_account_list()
    History:
        id: history_id


# transactions history
<History>:
    orientation: 'vertical'
    ScrollView:
        MDList:
            id: history_list_id

<ImportKeystore>:
    orientation: 'vertical'
    MDLabel:
        font_style: 'Display1'
        halign: 'center'
        text: "Import keystore"
    MDLabel:
        halign: 'center'
        text: 'Copy it in to the keystore directory.\n%s' % root.keystore_path
    PushUp:


<CreateNewAccount>:
    orientation: 'vertical'
    MDLabel:
        font_style: 'Display1'
        halign: 'center'
        text: "Create new account"
    MDTextField:
        hint_text: "Password"
        helper_text: "Enter the password for encrypting your new account"
        helper_text_mode: "on_focus"
        password: True
        text: root.new_password1
        on_text: root.new_password1 = args[1]
    MDTextField:
        # TODO: do validation as we type
        hint_text: "Password (again)"
        helper_text: "Retype your password"
        helper_text_mode: "on_focus"
        password: True
        text: root.new_password2
        on_text: root.new_password2 = args[1]
    MDLabel:
        text: "Security: %s%%" % int(security_slider_id.value)
    MDSlider:
        id: security_slider_id
        min: 0
        max: 100
        value: max(self.max - speed_slider_id.value, 1)
        step: 1
    MDLabel:
        text: "Speed: %s%%" % int(speed_slider_id.value)
    MDSlider:
        id: speed_slider_id
        min: security_slider_id.min
        max: security_slider_id.max
        step: security_slider_id.step
        value: max(self.max - security_slider_id.value, 1)
    MDRaisedButton:
        # TODO: center on x
        id: create_account_button_id
        text: "Create account"
        on_release: root.start_create_account_thread()
    PushUp:



<ManageExisting@BoxLayout>:
    orientation: 'vertical'
    MDLabel:
        font_style: 'Display1'
        halign: 'center'
        valign: 'middle'
        text: "Manage existing"
    MDFlatButton:
        # pos_hint: {'center_x': 0.5, 'top': 1}
        # size_hint: None, None
        text: root.current_account_string
        on_release: root.open_account_list()
    MDTextField:
        hint_text: "Current password"
        helper_text: "Enter your current password for unlocking your account"
        helper_text_mode: "on_focus"
        password: True
        text: root.current_password
        on_text: root.current_password = args[1]
    MDTextField:
        hint_text: "Password"
        helper_text: "Enter the password for encrypting your new account"
        helper_text_mode: "on_focus"
        password: True
        text: root.new_password1
        on_text: root.new_password1 = args[1]
    MDTextField:
        # TODO: do validation as we type
        hint_text: "Password (again)"
        helper_text: "Retype your password"
        helper_text_mode: "on_focus"
        password: True
        text: root.new_password2
        on_text: root.new_password2 = args[1]
    BoxLayout:
        orientation: 'horizontal'
        padding: dp(4), dp(4)
        spacing: dp(40)
        MDRaisedButton:
            text: "Update password"
            on_release: root.start_update_password_thread()
        MDRaisedButton:
            text: "Delete account"
            on_release: root.delete_account()
    PushUp:


<ManageKeystore@MDBottomNavigation>:
    id: bottom_navigation_id
    MDBottomNavigationItem:
        name: "manage_existing"
        text: "Manage"
        icon: 'format-list-bulleted'
        ManageExisting:
    MDBottomNavigationItem:
        name: "create_new"
        text: "Create new"
        icon: "plus"
        CreateNewAccount:
    MDBottomNavigationItem:
        name: "import_keystore"
        text: "Import"
        icon: "download"
        ImportKeystore:



<About>:
    orientation: 'vertical'
    MDLabel:
        size_hint_y: None
        height: dp(40)
        font_style: 'Display1'
        halign: 'center'
        text: "About PyWallet"
    MDLabel:
        markup: True
        text: root.about_text_property
        theme_text_color: 'Primary'
        on_ref_press: webbrowser.open(root.project_page_property)
    PushUp:
    MDRaisedButton:
        text: "Run tests"
        on_release: root.run_tests()


<PWToolbar>:
    title: 'PyWallet'
    md_bg_color: app.theme_cls.primary_color
    background_palette: 'Primary'
    background_hue: '500'


<Controller>:
    Navigation:
        id: navigation_id
        BoxLayout:
            orientation: 'vertical'
            PWToolbar:
                id: toolbar_id
            ScreenManager:
                id: screen_manager_id
                Screen:
                    name: 'overview'
                    MDBottomNavigation:
                        id: bottom_navigation_id
                        MDBottomNavigationItem:
                            name: 'overview'
                            text: "Overview"
                            icon: 'format-list-bulleted'
                            Overview:
                                id: overview_id
                        MDBottomNavigationItem:
                            name: 'send'
                            text: "Send"
                            icon: 'arrow-up-bold'
                            Send:
                                id: send_id
                        MDBottomNavigationItem:
                            name: 'receive'
                            text: "Receive"
                            icon: 'arrow-down-bold'
                            Receive:
                                id: receive_id
                Screen:
                    name: 'manage_keystores'
                    ManageKeystore:
                        id: manage_keystores_id
                Screen:
                    name: 'about'
                    About:
                        id: about_id
